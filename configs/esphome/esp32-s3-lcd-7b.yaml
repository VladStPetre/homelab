esphome:
  name: esp32-s3-lcd-7b
  friendly_name: esp32-s3-lcd-7b

psram:
  mode: octal
  speed: 80Mhz

esp32:
  variant: esp32s3
  board: esp32-s3-devkitc-1
  flash_size: 16MB
  cpu_frequency: 240MHz
  framework:
    type: esp-idf

# Enable logging
logger:

# Enable Home Assistant API
api:
  encryption:
    key: "sOXuW4k6R8kE068BVqUeTvKqWuvyfxqywpk1zfe5mTQ="

ota:
  - platform: esphome
    password: "8fb0182a7e50cc6e128658786a93382a"

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  use_address: 192.168.7.178

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "Esp32-S3-Lcd-7B Fallback Hotspot"
    password: "JWJjR0hqOUMM"

captive_portal:


#-------------------------------------------
# IO Extender
#-------------------------------------------
external_components:
  - source: github://esphome/esphome@latest
    components: [ lvgl ]
  - source: github://pr#10071
    components: [waveshare_io_ch32v003]
    refresh: 1h

waveshare_io_ch32v003:
  - id: waveshare_io_hub

#-------------------------------------------
# Touchscreen gt911
#-------------------------------------------
i2c:
  - id: bus_a
    sda: GPIO08
    scl: GPIO09
    scan: true

touchscreen:
  platform: gt911
  id: my_touchscreen
  display: my_display
  i2c_id: bus_a
  interrupt_pin: GPIO4
  reset_pin:
    waveshare_io_ch32v003: waveshare_io_hub
    number: 1
    mode: OUTPUT
      # on_touch:
      # - lambda: |-
      # ESP_LOGI("Touch", "Touch detected at x=%d, y=%d", touch.x, touch.y);
      # on_update:
      # - lambda: |-
      # for (auto touch: touches)  {
      # if (touch.state <= 2) {
      # ESP_LOGI("Touch points:", "id=%d x=%d, y=%d x.raw=%d, y.raw=%d", touch.id, touch.x, touch.y, touch.x_raw, touch.y_raw);
      # }
    # }

#-------------------------------------------
# Display
#-------------------------------------------
display:
  - platform: rpi_dpi_rgb
    id: my_display
    update_interval: never
    auto_clear_enabled: false
    color_order: RGB
    pclk_frequency: 30MHZ
    dimensions:
      width: 1024
      height: 600
    de_pin:
      number: 5
    hsync_pin:
      number: 46
      ignore_strapping_warning: true
    vsync_pin:
      number: 3
      ignore_strapping_warning: true
    pclk_pin: 7
    pclk_inverted: true
    reset_pin:
      waveshare_io_ch32v003: waveshare_io_hub
      number: 3
    hsync_back_porch: 152
    hsync_front_porch: 48
    hsync_pulse_width: 162
    vsync_back_porch: 13
    vsync_front_porch: 3
    vsync_pulse_width: 45
    data_pins:
      red:
        - 1         #r3
        - 2         #r4
        - 42        #r5
        - 41        #r6
        - 40        #r7
      blue:
        - 14        #b3
        - 38        #b4
        - 18        #b5
        - 17        #b6
        - 10        #b7
      green:
        - 39        #g2
        - 0         #g3
        - 45        #g4
        - 48        #g5
        - 47        #g6
        - 21        #g7

time:
  - platform: homeassistant
    id: ha_time

interval:
  - interval: 1s
    then:
      - if:
          condition:
            lambda: 'return id(ha_time).now().is_valid();'
          then:
            - lvgl.label.update:
                id: clock_label
                text: !lambda |-
                  auto t = id(ha_time).now();
                  char buf[6];
                  snprintf(buf, sizeof(buf), "%02d:%02d", t.hour, t.minute);
                  return std::string(buf);
# -------------------
# LVGL UI
# -------------------
lvgl:
  buffer_size: 25%
  displays:
    - my_display
  touchscreens:
    - my_touchscreen

  style_definitions:
    # Root background
    - id: style_root
      bg_color: 0x0B0F14
      bg_opa: 100%

    # Base tile (dark, rounded, slightly raised)
    - id: style_tile
      radius: 18
      bg_color: 0x101923
      bg_opa: 100%
      border_width: 1
      border_color: 0x1C2A38
      pad_all: 12
      shadow_width: 18
      shadow_opa: 25%
      shadow_spread: 1
      shadow_ofs_y: 6

    # “Glow” tile variant (neon border feel)
    - id: style_tile_glow
      radius: 18
      bg_color: 0x0F1822
      bg_opa: 100%
      border_width: 2
      border_color: 0x24D6C6   # teal glow
      pad_all: 14
      shadow_width: 22
      shadow_opa: 35%
      shadow_spread: 2
      shadow_ofs_y: 6

    # Small label text
    - id: style_text_dim
      text_color: 0xA9B4C0

    # Big center clock text
    - id: style_clock
      text_color: 0xE8F1FF

    # Subtitle in tiles
    - id: style_tile_title
      text_color: 0xBFD2E6

  pages:
    - id: main_page
      styles: style_root
      widgets:

        # GRID ROOT
        - obj:
            id: root_grid
            width: 100%
            height: 100%
            styles: style_root
            layout:
              type: grid
              grid_columns: [22%, 56%, 22%]
              grid_rows:    [20%, 60%, 20%]
              pad_row: 10
              pad_column: 10

            widgets:

              # CENTER TILE
              - obj:
                  styles: style_tile
                  grid_cell_column_pos: 1
                  grid_cell_row_pos: 1
                  grid_cell_column_span: 1
                  grid_cell_row_span: 1
                  grid_cell_x_align: stretch
                  grid_cell_y_align: stretch

                  widgets:
                    - label:
                        text: "HOME SYSTEM"
                        text_color: red
                        y: 8

                    - label:
                        id: clock_label
                        text: "--:--"
                        align: center
                        styles: style_clock